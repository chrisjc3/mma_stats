{
    "contents" : "\ncreate_event_table<-function(x){\n  ####################GET UPCOMING EVENT URLS#####################\n  event_urls<- x %>%\n    html_nodes(\"i a\") %>%\n    html_attrs() %>%\n    as.list()\n  \n  tags<-(\"http\\\\:(//www.fightmetric.com\\\\/event-details\\\\/)(.){16}\")\n  event_urls<-str_extract_all(event_urls, tags)\n  \n  ####################GET UPCOMING EVENT DATES#####################\n  event_dates<- x %>%\n    html_nodes(\"i span\") %>%\n    html_text() %>%\n    as.list()\n  \n  tags<-(\"[A-Z]\\\\w+\\\\s\\\\d\\\\d.\\\\s\\\\d\\\\d\\\\d\\\\d\")\n  event_dates<-str_extract_all(event_dates,tags)\n  \n  y<-cbind(event_urls,event_dates)\n  return(y)\n}\n\n\nget_event_stats<-function(x){\n  ############# GET FIGHTERS BASED ON EVENT URL #######\n  fight<-read_html(x)\n  stats<- fight %>%\n    html_nodes(\"td p\") %>%\n    html_text()\n  \n  ########## LOOP FIGHTERS TO TABLE ###################\n  hld<-NULL;wincol<-NULL;name<-NULL;\n  strikes<-NULL;takedowns<-NULL;subattempts<-NULL;\n  pospass<-NULL;weightclass<-NULL;result<-NULL;\n  round<-NULL;time<-NULL;\n  \n  for(i in seq(1,length(stats),16)){\n    if(str_trim(stats[i]) == \"win\"){\n      wincol[1] <- 1\n      wincol[2] <- 0\n      name[1] <- toupper(str_trim(stats[i+1]))\n      name[2] <- toupper(str_trim(stats[i+2]))\n      strikes[1] <- str_trim(stats[i+3])\n      strikes[2] <- str_trim(stats[i+4])\n      takedowns[1] <- str_trim(stats[i+5])\n      takedowns[2] <- str_trim(stats[i+6])\n      subattempts[1] <- str_trim(stats[i+7])\n      subattempts[2] <- str_trim(stats[i+8])\n      pospass[1] <- str_trim(stats[i+9])\n      pospass[2] <- str_trim(stats[i+10])\n      weightclass[1] <- str_trim(stats[i+11])\n      weightclass[2] <- str_trim(stats[i+11])\n      result[1] <- str_trim(stats[i+12])\n      result[2] <- str_trim(stats[i+12])\n      round[1] <- str_trim(stats[i+14])\n      round[2] <- str_trim(stats[i+14])\n      time[1] <- str_trim(stats[i+15])\n      time[2] <- str_trim(stats[i+15])\n      hldrow<-cbind(wincol,name,strikes,takedowns,subattempts,pospass,weightclass,result,round,time)\n      hld<-rbind(hld,hldrow)\n    }\n    if(str_trim(stats[i]) == \"draw\"){\n      wincol[1] <- \"\"\n      wincol[2] <- \"\"\n      name[1] <- toupper(str_trim(stats[i+2]))\n      name[2] <- toupper(str_trim(stats[i+3]))\n      strikes[1] <- str_trim(stats[i+4])\n      strikes[2] <- str_trim(stats[i+5])\n      takedowns[1] <- str_trim(stats[i+6])\n      takedowns[2] <- str_trim(stats[i+7])\n      subattempts[1] <- str_trim(stats[i+8])\n      subattempts[2] <- str_trim(stats[i+9])\n      pospass[1] <- str_trim(stats[i+10])\n      pospass[2] <- str_trim(stats[i+11])\n      weightclass[1] <- str_trim(stats[i+12])\n      weightclass[2] <- str_trim(stats[i+12])\n      result[1] <- str_trim(stats[i+13])\n      result[2] <- str_trim(stats[i+13])\n      round[1] <- str_trim(stats[i+14])\n      round[2] <- str_trim(stats[i+14])\n      time[1] <- str_trim(stats[i+15])\n      time[2] <- str_trim(stats[i+15])\n      hldrow<-cbind(wincol,name,strikes,takedowns,subattempts,pospass,weightclass,result,round,time)\n      hld<-rbind(hld,hldrow)\n    }\n    \n  }\n  return(hld)\n}\n\n\npull_upcoming_fighters<-function(x){\n  fight<-read_html(as.character(up_events[1]))\n  event<- fight %>%\n    html_nodes(\"td p\") %>%\n    html_text()\n  \n  hld<-NULL;name<-NULL;weight<-NULL;against<-NULL;\n  for(i in seq(1,length(event),10)){\n    name[1] <- toupper(str_trim(event[i+2]))\n    name[2] <- toupper(str_trim(event[i+3]))\n    against[1] <- str_trim(event[i+3])\n    against[2] <- str_trim(event[i+2])\n    weight[1] <- str_trim(event[i+5])\n    weight[2] <- str_trim(event[i+5])\n    hldrow<-cbind(name,against,weight)\n    hld<-rbind(hld,hldrow)\n  }\n  return(hld)\n}\n\n\nget_fighter_fights<-function(x){\n  hld<-NULL\n  for(i in seq(1,length(fighter_table[,2]),1)){\n    if(as.character(x) == as.character(fighter_table[i,2])){\n      if(fighter_table[i,1] == \"1\"){\n        hldf <- fighter_table[i,]\n        hldo <- fighter_table[i+1,]\n        hld<-rbind(hld,hldf,hldo)\n      }\n      if(fighter_table[i,1] == \"0\"){\n        hldf <- fighter_table[i,]\n        hldo <- fighter_table[i-1,]\n        hld<-rbind(hld,hldf,hldo)\n      }\n    }\n  }\n  return(hld)\n}\n\n\ncalculate_table_score<-function(x){\n  hld<-NULL\n  for(i in seq(1,length(x[,c(\"name\")]),1)){\n    score<-0\n    if(x[i,c(\"wincol\")]==\"1\"){\n      if(str_detect(x[i,c(\"result\")],\"KO\")==TRUE | str_detect(x[i,c(\"result\")],\"SUB\")==TRUE){\n        if(x[i,c(\"round\")]==\"1\"){score<-100}\n        if(x[i,c(\"round\")]==\"2\"){score<-70}\n        if(x[i,c(\"round\")]==\"3\"){score<-50}\n        if(x[i,c(\"round\")]==\"4\"){score<-40}\n        if(x[i,c(\"round\")]==\"5\"){score<-40}\n      }\n      if(str_detect(x[i,c(\"result\")],\"DEC\")==TRUE){score<-25}\n    }\n    score <- score + (as.numeric(x[i,c(\"strikes\")])*.5)\n    score <- score + (as.numeric(x[i,c(\"takedowns\")])*2)\n    hld <- rbind(hld,score)\n    colnames(hld)<-c(\"score\")\n  }\n  #MIGHT WANT TO PUT A SUM ROW!\n  return(hld)\n}\n\n\nget_betting_odds<-function(x){\n  vegas<-read_html('http://www.gamblerspalace.com/lines/martial-arts/')\n  odds<- vegas %>%\n    html_nodes(\"tr td\") %>%\n    html_text()\n  up_odds<-NULL\n  for(i in seq(1,length(odds),1)){\n    if(str_detect(odds[i],\"^[A-Z][a-z]+\\\\s.+\") & str_trim(odds[i]) != \"Bet Now\"){\n      h1<-toupper(odds[i])\n      h2<-odds[i+3]\n      hld<-cbind(h1,h2)\n      up_odds<-rbind(up_odds,hld)\n    }\n  }\n  colnames(up_odds)<-c(\"name\",\"ou\")\n  return(up_odds)\n}\n\n\nget_fights_sums<-function(x){\n  hld<-NULL\n  for(i in seq(1,length(x[,1]),1)){\n    fights<-NULL\n    try(fights<-read.csv(file=paste(local_path,x[i,c(\"name\")],\".csv\")), TRUE)\n    if(is.null(fights)==FALSE){\n      fights<-as.data.frame(fights)\n      fights<-fights[fights$name==as.character(x[i,c(\"name\")]),c(\"score\")]\n      fights<-summary(fights)\n      fights<-fights[c(\"Min.\", \"Mean\", \"Max.\")]\n      h1<-x[i,]\n      h2<-cbind(fights[1],fights[2],fights[3])\n      colnames(h2)<-c(\"min\",\"avg\",\"max\")\n      hr<-cbind(h1,h2)\n      hld<-rbind(hld,hr)\n    } else {\n      hr<-cbind(x[i,], \"NA\",\"NA\",\"NA\")\n      colnames(hr)<-c(colnames(x),\"min\",\"avg\",\"max\")\n      hld<-rbind(hld,hr)\n    }\n  }\n  return(hld)\n}\n\n\n\ncreate_fights_view<-function(x){\n  hld<-NULL;nmlst<-NULL;\n  for(i in seq_along(x[,1])){\n    name<-as.character(x[i,1])\n    found <-FALSE\n    if(is.null(nmlst)==TRUE){\n      for(j in seq_along(x[,1])){\n        if(name == as.character(x[j,2])){\n          h1<-as.data.frame(x[i,])\n          names(h1)<-paste0(names(h1),\"_f1\")\n          h1<-h1[,!(names(h1) %in% c(\"against_f1\"))]\n          h2<-as.data.frame(x[j,])\n          names(h2)<-paste0(names(h2),\"_f2\")\n          h2<-h2[,!(names(h2) %in% c(\"against_f2\"))]\n          hr<-cbind(h1,h2)\n          hld<-rbind(hld,hr)\n          nmlst<-c(as.character(x[j,1]),as.character(x[j,2]))\n          hr<-NULL\n        }\n      }\n    }\n    for(k in seq_along(nmlst)){if(name == as.character(nmlst[k])){found<-TRUE}}\n    if(found == FALSE){\n      for(j in seq_along(x[,1])){\n        if(name == as.character(x[j,2])){\n          h1<-as.data.frame(x[i,])\n          names(h1)<-paste0(names(h1),\"_f1\")\n          h1<-h1[,!(names(h1) %in% c(\"against_f1\"))]\n          h2<-as.data.frame(x[j,])\n          names(h2)<-paste0(names(h2),\"_f2\")\n          h2<-h2[,!(names(h2) %in% c(\"against_f2\"))]\n          hr<-cbind(h1,h2)\n          hld<-rbind(hld,hr)\n          nmlst<-c(nmlst, as.character(x[j,1]), as.character(x[j,2]))\n          hr<-NULL\n        }\n      }\n    } \n  }\n  return(hld)\n}\n\n\n\n\n",
    "created" : 1475084924651.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4157845641",
    "id" : "F4D5796",
    "lastKnownWriteTime" : 1475159904,
    "path" : "C:/git/fightmetrics/fm_functions.r",
    "project_path" : "fm_functions.r",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}